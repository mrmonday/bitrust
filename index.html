<!DOCTYPE html><html><head>
<title>BitRust - Breaking Changes in rust-lang/rust</title>
</head><body><pre>
commit 88463364bfb675fdecd2bf9b70c589cc5e7cb2fb
Merge: 077f4ee be4128d
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Sun Jan 17 06:47:55 2016 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Sun Jan 17 06:47:55 2016 +0000

    Auto merge of #30426 - gereeter:btree-rewrite, r=Gankro
    
    Despite being over 700 lines shorter, this implementation should use less memory than the previous one and is faster on at least insertions and iteration, the latter improving approximately 5x.
    
    Technically a [breaking-change] due to removal of deprecated functions.
    
    cc @apasel422 @Gankro @goyox86
    
    Fixes #27865.
    
    &lt;!-- Reviewable:start --&gt;
    [&lt;img src="https://reviewable.io/review_button.png" height=40 alt="Review on Reviewable"/&gt;](https://reviewable.io/reviews/rust-lang/rust/30426)
    &lt;!-- Reviewable:end --&gt;

commit 06c66d6ca23c73c60aeb0ea2c12baaf0236afe40
Author:     Peter Atashian &lt;retep998@gmail.com&gt;
AuthorDate: Fri Dec 4 22:36:01 2015 -0500
Commit:     Peter Atashian &lt;retep998@gmail.com&gt;
CommitDate: Sat Jan 16 12:34:54 2016 -0500

    Change name when outputting staticlibs on Windows
    libfoo.a -&gt; foo.lib
    In order to not cause conflicts, changes the DLL import library name
    foo.lib -&gt; foo.dll.lib
    
    Fixes https://github.com/rust-lang/rust/issues/29508
    
    Because this changes output filenames this is a [breaking-change]
    
    Signed-off-by: Peter Atashian &lt;retep998@gmail.com&gt;

commit 82f8e5ce84c83b02fbfa720c6841f12db1a55603
Author:     Nick Cameron &lt;ncameron@mozilla.com&gt;
AuthorDate: Thu Jan 7 09:23:01 2016 +1300
Commit:     Nick Cameron &lt;ncameron@mozilla.com&gt;
CommitDate: Fri Jan 15 14:49:25 2016 +1300

    Address reviewer comments
    
    [breaking-change]
    
    `OptLevel` variants are no longer `pub use`ed by rust::session::config. If you are using these variants, you must change your code to prefix the variant name with `OptLevel`.

commit b976d9e6660c16f4a1d5a28b11afa7ccb4f75da6
Author:     Nick Cameron &lt;ncameron@mozilla.com&gt;
AuthorDate: Thu Dec 31 18:47:14 2015 +1300
Commit:     Nick Cameron &lt;ncameron@mozilla.com&gt;
CommitDate: Fri Jan 15 10:24:12 2016 +1300

    Implement JSON error emission
    
    [breaking-change]
    
    syntax::errors::Handler::new has been renamed to with_tty_emitter
    
    Many functions which used to take a syntax::errors::ColorConfig, now take a rustc::session::config::ErrorOutputType. If you previously used ColorConfig::Auto as a default, you should now use ErrorOutputType::default().

commit 8796e012cbfa0bf63522e409edc10cbac5afaacd
Merge: f1bcfdd 34fe201
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Wed Jan 13 08:15:45 2016 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Wed Jan 13 08:15:45 2016 +0000

    Auto merge of #29498 - wthrowe:replace-pattern, r=alexcrichton
    
    It appears this was left out of RFC rust-lang/rfcs#528 because it might be useful to
    also generalize the second argument in some way.  That doesn't seem to
    prevent generalizing the first argument now, however.
    
    This is a [breaking-change] because it could cause type-inference to
    fail where it previously succeeded.
    
    Also update docs for a few other methods that still referred to `&amp;str` instead of patterns.

commit bac3eec67c367718c05585b72974c58a66f6abd0
Author:     Oliver Schneider &lt;git-spam-no-reply9815368754983@oli-obk.de&gt;
AuthorDate: Mon Jan 11 12:31:46 2016 +0100
Commit:     Oliver Schneider &lt;git-spam-no-reply9815368754983@oli-obk.de&gt;
CommitDate: Mon Jan 11 12:31:46 2016 +0100

    [breaking-change] remove negate_unsigned feature gate

commit 69e1f57dfbd32a1a342d696a3e79624da97ebe1b
Merge: d70ab2b 834fb17
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Jan 11 06:40:58 2016 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Jan 11 06:40:58 2016 +0000

    Auto merge of #30295 - jseyfried:fix_extern_crate_duplicate, r=nrc
    
    Fix a bug allowing an item and an external crate to collide so long as the external crate is declared after the item. For example,
    ```rust
    mod core { pub fn f() {} } // This would be an error if it followed the `extern crate`
    extern crate core; // This declaration is shadowed by the preceding module
    
    fn main() { core::f(); }
    ```
    This is a [breaking-change], but it looks unlikely to cause breakage in practice, and any breakage can be fixed by removing colliding `extern crate` declarations, which are shadowed and hence unused.

commit 91b27ec9beb8455426da3efd26dfc9155058f5bd
Merge: 4406717 6dd3f61
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Thu Jan 7 06:32:56 2016 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Thu Jan 7 06:32:56 2016 +0000

    Auto merge of #30724 - nikomatsakis:feature-gate-defaulted-type-parameters, r=pnkfelix
    
    It was recently realized that we accept defaulted type parameters everywhere, without feature gate, even though the only place that we really *intended* to accept them were on types. This PR adds a lint warning unless the "type-parameter-defaults" feature is enabled. This should eventually become a hard error.
    
    This is a [breaking-change] in that new feature gates are required (or simply removing the defaults, which is probably a better choice as they have little effect at this time). Results of a [crater run][crater] suggest that approximately 5-15 crates are affected. I didn't do the measurement quite right so that run cannot distinguish "true" regressions from "non-root" regressions, but even the upper bound of 15 affected crates seems relatively minimal.
    
    [crater]: https://gist.github.com/nikomatsakis/760c6a67698bd24253bf
    
    cc @rust-lang/lang
    r? @pnkfelix

commit 5daa75373d870f255923aed37d99db73a661bd51
Merge: e8c337b 9023c65
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Wed Jan 6 20:30:55 2016 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Wed Jan 6 20:30:55 2016 +0000

    Auto merge of #30654 - nrc:panictry, r=brson
    
    The motivation (other than removing boilerplate) is that this is a baby step towards a parser with error recovery.
    
    [breaking-change] if you use any of the changed functions, you'll need to remove a try! or panictry!

commit e8c337b5ca883285e6215f1f669d5556842d1520
Merge: 21b025f 93996b1
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Wed Jan 6 18:37:57 2016 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Wed Jan 6 18:37:57 2016 +0000

    Auto merge of #30532 - nikomatsakis:cross-item-dependencies, r=mw
    
    This is roughly the same as my previous PR that created a dependency graph, but that:
    
    1. The dependency graph is only optionally constructed, though this doesn't seem to make much of a difference in terms of overhead (see measurements below).
    2. The dependency graph is simpler (I combined a lot of nodes).
    3. The dependency graph debugging facilities are much better: you can now use `RUST_DEP_GRAPH_FILTER` to filter the dep graph to just the nodes you are interested in, which is super help.
    4. The tests are somewhat more elaborate, including a few known bugs I need to fix in a second pass.
    
    This is potentially a `[breaking-change]` for plugin authors. If you are poking about in tcx state or something like that, you probably want to add `let _ignore = tcx.dep_graph.in_ignore();`, which will cause your reads/writes to be ignored and not affect the dep-graph.
    
    After this, or perhaps as an add-on to this PR in some cases, what I would like to do is the following:
    
    - [x] Write-up a little guide to how to use this system, the debugging options available, and what the possible failure modes are.
    - [ ] Introduce read-only and perhaps the `Meta` node
    - [x] Replace "memoization tasks" with node from the map itself
    - [ ] Fix the shortcomings, obviously! Notably, the HIR map needs to register reads, and there is some state that is not yet tracked. (Maybe as a separate PR.)
    - [x] Refactor the dep-graph code so that the actual maintenance of the dep-graph occurs in a parallel thread, and the main thread simply throws things into a shared channel (probably a fixed-size channel). There is no reason for dep-graph construction to be on the main thread. (Maybe as a separate PR.)
    
    Regarding performance: adding this tracking does add some overhead, approximately 2% in my measurements (I was comparing the build times for rustdoc). Interestingly, enabling or disabling tracking doesn't seem to do very much. I want to poke at this some more and gather a bit more data -- in some tests I've seen that 2% go away, but on others it comes back. It's not entirely clear to me if that 2% is truly due to constructing the dep-graph at all.
    
    The next big step after this is write some code to dump the dep-graph to disk and reload it.
    
    r? @michaelwoerister

commit 21b025f55fa7f68982f9faf58522da11b3d91815
Merge: d5ac1a1 14e1e2a
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Wed Jan 6 15:00:17 2016 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Wed Jan 6 15:00:17 2016 +0000

    Auto merge of #30733 - ubsan:wrapping_op_assign, r=eddyb
    
    Fix a breaking change in #30523
    
    While this does fix a breaking change, it is also, technically, a
    [breaking-change] to go back to our original way

commit 14e1e2aee812978c81d4edf23359e7dca444d678
Author:     Nicholas Mazzuca &lt;npmazzuca@gmail.com&gt;
AuthorDate: Tue Jan 5 22:16:03 2016 -0800
Commit:     Nicholas Mazzuca &lt;npmazzuca@gmail.com&gt;
CommitDate: Tue Jan 5 22:16:03 2016 -0800

    Fix a breaking change in #30523
    
    While this does fix a breaking change, it is also, technically, a
    [breaking-change] to go back to our original way

commit d5e229057c93222afd4943a49d382c4c5d6e8c26
Merge: 41611ba 33f3c52
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Jan 4 23:57:46 2016 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Jan 4 23:57:46 2016 +0000

    Auto merge of #30681 - Toby-S:master, r=bluss
    
    Make `".".parse::&lt;f32&gt;()` and `".".parse::&lt;f64&gt;()` return Err
    
    This fixes #30344.
    
    This is a [breaking-change], which the libs team have classified as a
    bug fix.

commit 5e8cb3819bf62527947634ad4d5e44b4b69daecd
Merge: b622891 402259d
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Jan 4 18:37:21 2016 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Jan 4 18:37:21 2016 +0000

    Auto merge of #30523 - ubsan:wrapping_op_assign, r=eddyb
    
    Add OpAssign to Wrapping&lt;T&gt;, plus fix some problems in core::num::wrapping
    
    including, but not limited to:
    
    * Testing Wrapping&lt;T&gt;
    * Pull out a lot of broken code that doesn't need to be there with the new stage0 compiler
    * Adding Rem and RemAssign to Wrapping&lt;T&gt;
    * Removed 3 (assumed accidental) re-exports, which is a minor [breaking-change].
    * Change shl and shr to take all integer types, instead of a usize; this is a more major [breaking-change], because of values that were inferred before, but brings us in line with the integer shifts.
    
    Fixes #30524 and #30523

commit 33f3c52d32e6f91494bc305fd25f9d5ae5a11702
Author:     Toby Scrace &lt;toby.scrace@gmail.com&gt;
AuthorDate: Sun Jan 3 20:08:53 2016 +0000
Commit:     Toby Scrace &lt;toby.scrace@gmail.com&gt;
CommitDate: Mon Jan 4 18:23:33 2016 +0000

    Make float parsing "." return Err
    
    This makes both of the following return Err:
    
        ".".parse::&lt;f32&gt;()
        ".".parse::&lt;f64&gt;()
    
    This is a [breaking-change], which the libs team have classified as a
    bug fix.

commit 9023c659af8a43dd5e284d7b311e5f19721c9bd8
Author:     Nick Cameron &lt;ncameron@mozilla.com&gt;
AuthorDate: Thu Dec 31 12:11:53 2015 +1300
Commit:     Nick Cameron &lt;ncameron@mozilla.com&gt;
CommitDate: Thu Dec 31 14:29:02 2015 +1300

    Cut out a bunch of Result and panictry! boilerplate from libsyntax.
    
    [breaking-change] if you use any of the changed functions, you'll need to remove a try! or panictry!

commit ef91cdb140d7dffa4b04f42ab0bc02dc257940e3
Merge: 29ea4ee 785cbe0
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Fri Dec 18 18:54:52 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Fri Dec 18 18:54:52 2015 +0000

    Auto merge of #29973 - petrochenkov:privinpub, r=nikomatsakis
    
    Some notes:
    This patch enforces the rules from [RFC 136](https://github.com/rust-lang/rfcs/blob/master/text/0136-no-privates-in-public.md) and makes "private in public" a module-level concept and not crate-level. Only `pub` annotations are used by the new algorithm, crate-level exported node set produced by `EmbargoVisitor` is not used. The error messages are tweaked accordingly and don't use the word "exported" to avoid confusing people (https://github.com/rust-lang/rust/issues/29668).
    
    The old algorithm tried to be extra smart with impls, but it mostly led to unpredictable behavior and bugs like https://github.com/rust-lang/rust/issues/28325.
    The new algorithm tries to be as simple as possible - an impl is considered public iff its type is public and its trait is public (if presents).
    A type or trait is considered public if all its components are public, [complications](https://internals.rust-lang.org/t/limits-of-type-inference-smartness/2919) with private types leaking to other crates/modules through trait impls and type inference are deliberately ignored so far.
    
    The new algorithm is not recursive and uses the nice new facility `Crate::visit_all_items`!
    
    Obsolete pre-1.0 feature `visible_private_types` is removed.
    
    This is a [breaking-change].
    The two main vectors of breakage are type aliases (https://github.com/rust-lang/rust/issues/28450) and impls (https://github.com/rust-lang/rust/issues/28325).
    I need some statistics from a crater run (cc @alexcrichton) to decide on the breakage mitigation strategy.
    UPDATE: All the new errors are reported as warnings controlled by a lint `private_in_public` and lint group `future_incompatible`, but the intent is to make them hard errors eventually.
    
    Closes https://github.com/rust-lang/rust/issues/28325
    Closes https://github.com/rust-lang/rust/issues/28450
    Closes https://github.com/rust-lang/rust/issues/29524
    Closes https://github.com/rust-lang/rust/issues/29627
    Closes https://github.com/rust-lang/rust/issues/29668
    Closes https://github.com/rust-lang/rust/issues/30055
    
    r? @nikomatsakis

commit ce7bc51933e2facb4eca029ac17b398f372f5b41
Merge: ac2c5ff 0883f10
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Wed Dec 16 10:09:36 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Wed Dec 16 10:09:36 2015 +0000

    Auto merge of #30300 - sanxiyn:syntax-ext, r=nikomatsakis
    
    This reduces iteration time (`make rustc-stage1`) for moved syntax extensions from 11 minutes to 3 minutes on my machine.
    
    Because of the signature change, this is a [breaking-change] for people directly calling `expand_crate`. I think it is rare: from GitHub search, only case I found is [glassful](https://github.com/kmcallister/glassful).

commit ec8ea22c7f59fd898670060bceb6810cef68ca0a
Author:     faineance &lt;faineance@users.noreply.github.com&gt;
AuthorDate: Sat Nov 28 19:02:07 2015 +0000
Commit:     faineance &lt;faineance@users.noreply.github.com&gt;
CommitDate: Mon Dec 14 21:15:01 2015 +0000

    [breaking-change] move ast_util functions to methods

commit 672a3d93e34ad52529f3bdedfd26d52d67824ccd
Merge: ae5d095 ada87fa
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Fri Dec 11 04:27:53 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Fri Dec 11 04:27:53 2015 +0000

    Auto merge of #30294 - jseyfried:fix_shadowed_use_visibility, r=nrc
    
    This fixes a bug in which the visibility of a use declaration defining a name in one namespace (e.g. the value namespace) is overridden by a later use declaration defining the same name in the other namespace (e.g. the type namespace). For example,
    ```rust
    fn f() {}
    pub mod bar {}
    
    mod foo {
        use f; // This import should not be visible outside `foo`,
        pub use bar as f; // but it visible outside of `foo` because of this import.
    }
    
    fn main() { foo::f(); }
    ```
    As the example demonstrates, this is a [breaking-change], but it looks unlikely to cause breakage in practice, and any breakage can be fixed by correcting visibility modifiers.

commit e7f3d6eddd28a917c9a0f7cd73a489048ca7f4cd
Author:     William Throwe &lt;wtt6@cornell.edu&gt;
AuthorDate: Sun Nov 1 00:21:47 2015 -0400
Commit:     William Throwe &lt;wtt6@cornell.edu&gt;
CommitDate: Mon Dec 7 22:08:33 2015 -0500

    Let str::replace take a pattern
    
    It appears this was left out of RFC #528 because it might be useful to
    also generalize the second argument in some way.  That doesn't seem to
    prevent generalizing the first argument now, however.
    
    This is a [breaking-change] because it could cause type-inference to
    fail where it previously succeeded.

commit e819d8aa3cd2319fa57e7336e167069ef7002d6a
Merge: 64c21f9 0ca2a9e
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Dec 7 02:16:13 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Dec 7 02:16:13 2015 +0000

    Auto merge of #30247 - bluss:revert-array-clone, r=alexcrichton
    
    Revert "PR #30130 Implement `Clone` for more arrays"
    
    This reverts commit e22a64e8d8d4da46c74f878ce1c23ad1c88982e8.
    
    This caused a regression such that types like `[[u8; 256]; 4]`
    no longer implemented Clone. This previously worked due to Clone
    for `[T; N]` (N in 0 to 32) being implemented for T: Copy.
    
    Due to fixed size arrays not implementing Clone for sizes above 32,
    the new implementation requiring T: Clone would not allow
    `[[u8; 256]; 4]` to be Clone.
    
    Fixes #30244
    
    Due to changing back, this is technically a [breaking-change],
    albeit for a behavior that existed for a very short time.

commit e22a64e8d8d4da46c74f878ce1c23ad1c88982e8
Merge: 55a4e05 6dff9d0
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Fri Dec 4 22:52:02 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Fri Dec 4 22:52:02 2015 +0000

    Auto merge of #30130 - tbu-:pr_array_clone, r=alexcrichton
    
    [breaking-change]

commit e9ac44026d2d4ac11728263726505ea4cea3c1ff
Merge: bac2b13 af96402
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Sat Nov 28 00:45:34 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Sat Nov 28 00:45:34 2015 +0000

    Auto merge of #29383 - petrochenkov:empstr, r=pnkfelix
    
    Fixes https://github.com/rust-lang/rust/issues/28692
    Fixes https://github.com/rust-lang/rust/issues/28992
    Fixes some other similar issues (see the tests)
    
    [breaking-change], needs crater run (cc @brson or @alexcrichton )
    
    The pattern with parens `UnitVariant(..)` for unit variants seems to be popular in rustc (see the second commit), but mostly used by one person (@nikomatsakis), according to git blame. If it causes breakage on crates.io I'll add an exceptional case for it.

commit 6ef02eff89e3d2a29eab3346bff393821df6e033
Merge: 6f3becb 43a6deb
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Thu Nov 26 18:20:58 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Thu Nov 26 18:20:58 2015 +0000

    Auto merge of #30043 - arielb1:split-metadata, r=nikomatsakis
    
    This improves bootstrap times because of better parallelism - though I need to measure how much - and allows metadata to be modified without triggering a full recompile. This also ensures that metadata handling and the rest of rustc remain decoupled, which is a first step for switching to a new metadata format.
    
    This is a [breaking-change] to all plugin authors because of the following renames:
     * `rustc::plugin` is now `rustc_plugin`
     * `rustc::metadata` is now `rustc_metadata`
     * Most data types from `rustc::metadata`, along with `LOCAL_CRATE`, are now in `rustc::middle::cstore`.
     * The CStore methods were split between the `rustc::middle::CrateStore` trait (and trait object) and the `rustc_metadata::cstore::CStore`, with an `Rc&lt;CrateStore&gt;` stored in the `Session`. The inner `CStore` can be accessed via the inner `Any` bound, but this is deprecated.
    
    r? @nikomatsakis

commit 1430a3500076ad504a0b30be77fd2ad4468ea769
Author:     Ariel Ben-Yehuda &lt;ariel.byd@gmail.com&gt;
AuthorDate: Sun Nov 22 22:14:09 2015 +0200
Commit:     Ariel Ben-Yehuda &lt;arielb1@mail.tau.ac.il&gt;
CommitDate: Thu Nov 26 18:22:39 2015 +0200

    move librustc/plugin to librustc_plugin
    
    this is a [breaking-change] to all plugin authors - sorry

commit 3c0d55cc76c524c12160bfb45663d9aca73e6556
Author:     Ariel Ben-Yehuda &lt;ariel.byd@gmail.com&gt;
AuthorDate: Thu Nov 19 00:43:31 2015 +0200
Commit:     Ariel Ben-Yehuda &lt;ariel.byd@gmail.com&gt;
CommitDate: Thu Nov 19 20:53:59 2015 +0200

    constrained_type_params: make projections depend on their trait-ref
    
    As this is a soundness fix, it is a [breaking-change].
    
    Fixes #29861.

commit 767ee79c4c38e7909c7fefef1b33be4612112336
Author:     Niko Matsakis &lt;niko@alum.mit.edu&gt;
AuthorDate: Tue Nov 17 17:32:12 2015 -0500
Commit:     Niko Matsakis &lt;niko@alum.mit.edu&gt;
CommitDate: Wed Nov 18 19:22:18 2015 -0500

    Refactor the HIR so that items are stored in a map in the `Crate`,
    rather being stored inline. Refactor (and rename) the visitor so that
    (by default) it only visits the interior content of an item not nested
    items.
    
    This is a [breaking-change] for anyone who uses the HIR visitor. Besides
    changing `visit::` to `intravisit::`, you need to refactor your visitor
    in one of two ways, depending on what it requires:
    
    1. If you just want to visit all items (most common), you should call
       `krate.visit_all_items(&amp;mut visitor)`.
    
    2. If you need to visit nested items in the middle of the parent items,
       you should override `visit_nested_item` with something like:
       `self.visit_item(self.tcx.map.expect_item(item.id))`, presuming you
       have access to a tcx (or at least a HIR map).

commit ad3bd1b46d52ccb339a09558064b9bf687c47a75
Merge: 5f64201 41ccd44
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Wed Nov 11 00:25:08 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Wed Nov 11 00:25:08 2015 +0000

    Auto merge of #29726 - petrochenkov:privsan, r=alexcrichton
    
    - Check privacy sanity in all blocks, not only function bodies
    - Check all fields, not only named
    - Check all impl items, not only methods
    - Check default impls
    - Move the sanity check in the beginning of privacy checking, so others could rely on it
    
    Technically it's a [breaking-change], but I expect no breakage because, well, it's *sane* privacy visitor, if code is broken it must be insane by definition!

commit 749625ad6d15d0254b90e3d16f79d1cb1e260969
Merge: e2bb53c 8cf50bc
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Tue Nov 3 01:23:10 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Tue Nov 3 01:23:10 2015 +0000

    Auto merge of #29500 - vadimcn:rustlib, r=alexcrichton
    
    According to a recent [discussion on IRC](https://botbot.me/mozilla/rust-tools/2015-10-27/?msg=52887517&amp;page=2), there's no good reason for Windows builds to store target libraries under `bin`, when on every other platform they are under `lib`.
    
    This might be a [breaking-change] for some users.  I am pretty sure VisualRust has that path hard-coded somewhere.
    
    r? @brson

commit 6d43fef3aaf64b2e7df14ca676a3a39b723ed7f3
Merge: a5fbb3a 306b0ef
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Sun Nov 1 13:36:49 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Sun Nov 1 13:36:49 2015 +0000

    Auto merge of #29486 - petrochenkov:multiwild, r=Manishearth
    
    Motivation:
    - It is not actually a pattern
    - It is not actually needed, except for...
    
    Drawback:
    - Slice patterns like `[a, _.., b]` are pretty-printed as `[a, .., b]`. Great loss :(
    
    plugin-[breaking-change], as always

commit c44316d4a1ad0fe01ae366e163993aa3980c755f
Merge: 72ed590 e8ddbba
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Oct 26 08:27:59 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Oct 26 08:27:59 2015 +0000

    Auto merge of #29303 - petrochenkov:unistrimp, r=eddyb
    
    And use `VariantData` instead of `P&lt;VariantData&gt;` in `Item_` and `Variant_`
    
    Improvements suggested by @eddyb in https://github.com/rust-lang/rust/pull/28816#discussion_r42483587 and https://github.com/rust-lang/rust/pull/28816#discussion_r42483648
    
    plugin-[breaking-change]
    
    r? @eddyb

commit 04e497c0056aed899cd6edbc98e7a68a9b391c5c
Merge: 43869e9 5d6d26c
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Sat Oct 24 12:21:12 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Sat Oct 24 12:21:12 2015 +0000

    Auto merge of #29259 - arielb1:supertrait-self-2, r=eddyb
    
    …being it
    
    This is a [breaking-change]:lang, but the broken code does not make
    much sense.
    
    Fixes #26056
    
    r? @eddyb

commit 5d6d26c241b785daef873a0c6b9a0553c3a9451d
Author:     Ariel Ben-Yehuda &lt;ariel.byd@gmail.com&gt;
AuthorDate: Sat Oct 24 00:01:11 2015 +0300
Commit:     Ariel Ben-Yehuda &lt;ariel.byd@gmail.com&gt;
CommitDate: Sat Oct 24 00:22:29 2015 +0300

    object_safety: check whether a supertrait contains Self even without being it
    
    This is a [breaking-change]:lang, but the broken code does not make
    much sense.
    
    Fixes #26056

commit 97ba52ec379e17cc0984224b756282b68bc3a53b
Merge: 5e9f305 025cf75
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Tue Oct 20 19:02:27 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Tue Oct 20 19:02:27 2015 +0000

    Auto merge of #29148 - petrochenkov:noshow, r=alexcrichton
    
    Closes https://github.com/rust-lang/rust/issues/29145
    
    [breaking-change], needs a crater run.

commit d6bd8d8491e89277edbfc9a4e0f8953847abbdd6
Author:     Andrew Paseltiner &lt;apaseltiner@gmail.com&gt;
AuthorDate: Fri Oct 16 11:54:05 2015 -0400
Commit:     Andrew Paseltiner &lt;apaseltiner@gmail.com&gt;
CommitDate: Fri Oct 16 18:35:31 2015 -0400

    Add `Shared` pointer and have `{Arc, Rc}` use it
    
    This change has two consequences:
    
    1. It makes `Arc&lt;T&gt;` and `Rc&lt;T&gt;` covariant in `T`.
    
    2. It causes the compiler to reject code that was unsound with respect
    to dropck. See compile-fail/issue-29106.rs for an example of code that
    no longer compiles. Because of this, this is a [breaking-change].
    
    Fixes #29037.
    Fixes #29106.

commit 130851e03046db41d555a401a08c87f187fd911a
Merge: 6d11a81 2f23e17
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Sat Oct 3 22:07:37 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Sat Oct 3 22:07:37 2015 +0000

    Auto merge of #28669 - arielb1:well-formed-methods, r=nikomatsakis
    
    By RFC1214:
    &gt;    Before calling a fn, we check that its argument and return types are WF.
    
    The previous code only checked the trait-ref, which was not enough
    in several cases.
    
    As this is a soundness fix, it is a [breaking-change]. Some new annotations are needed, which I think are because of #18653 and the imperfection of `projection_must_outlive` (that can probably be worked around by moving the wf obligation later).
    
    Fixes #28609
    
    r? @nikomatsakis

commit 603a75c8eaa8ee168e4333e4fba5eb782ed7192b
Author:     Ariel Ben-Yehuda &lt;arielb1@mail.tau.ac.il&gt;
AuthorDate: Sat Sep 26 01:27:39 2015 +0300
Commit:     Ariel Ben-Yehuda &lt;ariel.byd@gmail.com&gt;
CommitDate: Fri Oct 2 23:40:10 2015 +0300

    ensure that the types of methods are well-formed
    
    By RFC1214:
    Before calling a fn, we check that its argument and return types are WF. This check takes place after all higher-ranked lifetimes have been instantiated. Checking the argument types ensures that the implied bounds due to argument types are correct. Checking the return type ensures that the resulting type of the call is WF.
    
    The previous code only checked the trait-ref, which was not enough
    in several cases.
    
    As this is a soundness fix, it is a [breaking-change].
    
    Fixes #28609

commit ef07d7dd40e33d7af95c7b00717503730ce69c11
Merge: e650491 61f5b2b
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Fri Oct 2 19:16:39 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Fri Oct 2 19:16:39 2015 +0000

    Auto merge of #28650 - sanxiyn:attr-usage, r=nrc
    
    This is technically a [breaking-change].
    
    Fix #2809.
    Fix #22746.

commit e82faeb65594302897223b2ca4ee6927fb54625f
Merge: 24202c6 f0dc7bd
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Thu Oct 1 16:26:28 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Thu Oct 1 16:26:28 2015 +0000

    Auto merge of #28742 - nikomatsakis:def-id-encapsulate, r=eddyb
    
    As described in https://github.com/rust-lang/rfcs/pull/1298, the idea here is to make DefIds independent of changes to the content of other items. They are also *mostly* independent from ordering, so e.g. reordering two functions will change the defids, but it will not change the paths that they expand into (but this is not the case for some things, such as impls).
    
    This is a major refactoring, so I did it in slices. The final commit is in some sense The Big One where most of the work is done. The earlier commits just pave the way by gradually refactoring accesses to the `node` field.
    
    This is a [breaking-change] for plugin authors. The things you need to do to migrate your code are as follows:
    
    1. For local def-ids, rather than do `def_id.node`, call `tcx.map.as_local_node_id(def_id)`.
    2. To construct a local def-id, call `tcx.map.local_def_id(node_id)`.
    3. Note that you cannot make def-ids for any node, but only for "definitions" -- which include all items, as well as a number of other things, but not e.g. arbitrary expressions.
    4. You can get the path to a def-id by calling `tcx.def_path(def_id)`.
    
    One thing that is NOT part of this PR, but which I plan do in a follow-up, is converting uses of the existing `with_path` API to use `def_path`, which is basically the same.
    
    r? @eddyb (or @nrc)

commit 587be42d0bd318d6c2f41fe4716e040366dc8951
Merge: 031dd9c 9502df5
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Thu Oct 1 04:29:04 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Thu Oct 1 04:29:04 2015 +0000

    Auto merge of #28605 - alexcrichton:link-native-first, r=brson
    
    This commit swaps the order of linking local native libraries and upstream
    native libraries on the linker command line. Detail of bugs this can cause can
    be found in #28595, and this change also invalidates the test case that was
    added for #12446 which is now considered a bug because the downstream dependency
    would need to declare that it depends on the native library somehow.
    
    Closes #28595
    [breaking-change]

commit 5ca60d94316bd56f412ef4c13292237e206babf1
Merge: 6a21874 f293ea2
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Thu Sep 24 20:42:56 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Thu Sep 24 20:42:56 2015 +0000

    Auto merge of #28608 - eddyb:no-place-for-an-old-box, r=pnkfelix
    
    While this is technically a [breaking-change], there is no excuse for touching `HEAP`.
    r? @pnkfelix

commit 6a2187414a8c25f485dc788088b4466f595a7dd9
Merge: e980129 b30d896
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Thu Sep 24 18:55:00 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Thu Sep 24 18:55:00 2015 +0000

    Auto merge of #28538 - alevy:make_fixedsizearray_unsafe, r=alexcrichton
    
    [breaking-change]
    
    `FixedSizeArray` is meant to be implemented for arrays of fixed size only, but can be implemented for anything at the moment. Marking the trait unsafe would make it more reasonable to write unsafe code which operates on fixed size arrays of any size.
    
    For example, using `uninitialized` to create a fixed size array and immediately filling it with a fixed value is externally safe:
    
    ```
    pub fn init_with_nones&lt;T, A: FixedSizeArray&lt;Option&lt;T&gt;&gt;&gt;() -&gt; A {
        let mut res = unsafe { mem::uninitialized() };
        for elm in res.as_mut_slice().iter_mut() {
            *elm = None;
        }
        res
    }
    ```
    
    But the same code is not safe if `FixedSizeArray` is implemented for other types:
    
    ```
    struct Foo { foo: usize }
    impl FixedSizeArray&lt;Option&lt;usize&gt;&gt; for Foo {
        fn as_slice(&amp;self) -&gt; &amp;[usize] { &amp;[] }
        fn as_mut_slice(&amp;self) -&gt; &amp;mut [usize] { &amp;mut [] }
    }
    ```
    
    now `init_with_nones() : Foo` returns a `Foo` with an undefined value for the field `foo`.

commit 920f32becd5d54864a966900963a376d74d09922
Author:     Sebastian Wicki &lt;gandro@gmx.net&gt;
AuthorDate: Mon Sep 21 19:02:46 2015 +0200
Commit:     Sebastian Wicki &lt;gandro@gmx.net&gt;
CommitDate: Tue Sep 22 00:33:40 2015 +0200

    Add `no_default_libraries` target linker option
    
    If set to false, `-nodefaultlibs` is not passed to the linker. This
    was the default behavior on Windows, but it should be configurable
    per target.
    
    This is a [breaking-change] for target specifications that have
    the `is_like_windows` option set to true. Such targets need to
    set `no_default_libraries` to false in order to restore the old
    behavior.

commit a642d853aa29f8ec8486e736be551cf77f34e219
Author:     Nick Cameron &lt;ncameron@mozilla.com&gt;
AuthorDate: Tue Sep 15 11:35:25 2015 +1200
Commit:     Nick Cameron &lt;ncameron@mozilla.com&gt;
CommitDate: Thu Sep 17 12:16:46 2015 +1200

    Change to a multi-trait approach
    
    [breaking-change] for lint authors
    
    You must now implement LateLintPass or EarlyLintPass as well as LintPass and use either register_late_lint_pass or register_early_lint_pass, rather than register_lint_pass.

commit 76856e19ff3c7c699931d0acee8e61bc0dfec512
Author:     Nick Cameron &lt;ncameron@mozilla.com&gt;
AuthorDate: Thu Sep 10 16:40:59 2015 +1200
Commit:     Nick Cameron &lt;ncameron@mozilla.com&gt;
CommitDate: Thu Sep 17 12:16:46 2015 +1200

    Add an early lint pass for lints that operate on the AST
    
    There is a minor [breaking-change] for lint authors - some functions which were previously defined on `lint::Context` have moved to a trait - `LintContext`, you may need to import that trait to avoid name resolution errors.

commit fc4d566b432d48933e27dd65a973c936b564d6e9
Merge: 9bc1fae e9f1b06
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Wed Sep 16 00:35:24 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Wed Sep 16 00:35:24 2015 +0000

    Auto merge of #28399 - nrc:attrs, r=nikomatsakis
    
    This could be a [breaking-change] if your lint or syntax extension (is that even possible?) uses HIR attributes or literals.

commit e9f1b063295c48c97e239ce479b08f192a3eece4
Author:     Nick Cameron &lt;ncameron@mozilla.com&gt;
AuthorDate: Mon Sep 14 21:58:20 2015 +1200
Commit:     Nick Cameron &lt;ncameron@mozilla.com&gt;
CommitDate: Wed Sep 16 10:57:06 2015 +1200

    Use ast attributes every where (remove HIR attributes).
    
    This could be a [breaking-change] if your lint or syntax extension (is that even possible?) uses HIR attributes or literals.

commit 4d6dc7f9ba9fe61e38d737b29bfe490e835f6921
Merge: 009f2cf 5d44555
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Sep 14 06:51:18 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Sep 14 06:51:18 2015 +0000

    Auto merge of #28396 - arielb1:misplaced-binding, r=eddyb
    
    Technically a [breaking-change], but the broken code is useless,
    like `i32&lt;Param=()&gt;`.
    
    Fixes #24682
    
    r? @eddyb

commit 5d4455510afe3b7f74e04d3125ef8536a63d9e60
Author:     Ariel Ben-Yehuda &lt;ariel.byd@gmail.com&gt;
AuthorDate: Sun Sep 13 23:05:04 2015 +0300
Commit:     Ariel Ben-Yehuda &lt;ariel.byd@gmail.com&gt;
CommitDate: Sun Sep 13 23:47:41 2015 +0300

    ensure projections are prohibited when type parameters are
    
    Technically a [breaking-change], but the broken code is useless,
    like `i32&lt;Param=()&gt;`.
    
    Fixes #24682

commit ae75ef9e62b7df8c46865cfb907c56cab1f29f81
Merge: 4ad128b 20e1ea2
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Tue Sep 1 09:12:52 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Tue Sep 1 09:12:52 2015 +0000

    Auto merge of #28137 - nrc:remove-non-multi, r=huonw
    
    This is a [breaking-change] for syntax extension authors. The fix is to use MultiModifier or MultiDecorator, which have the same functionality but are more flexible. Users of syntax extensions are unaffected.

commit 20e1ea2dd84d5b29414059a4e07ce7327d1bef19
Author:     Nick Cameron &lt;ncameron@mozilla.com&gt;
AuthorDate: Tue Sep 1 13:16:03 2015 +1200
Commit:     Nick Cameron &lt;ncameron@mozilla.com&gt;
CommitDate: Tue Sep 1 13:16:03 2015 +1200

    Remove the Modifier and Decorator kinds of syntax extensions.
    
    This is a [breaking-change] for syntax extension authors. The fix is to use MultiModifier or MultiDecorator, which have the same functionality but are more flexible. Users of syntax extensions are unaffected.

commit 1f81ef4d0f2547cacc316b01ad03603ad772e38e
Author:     Tobias Bucher &lt;tobiasbucher5991@gmail.com&gt;
AuthorDate: Mon Aug 24 13:57:11 2015 +0200
Commit:     Tobias Bucher &lt;tobiasbucher5991@gmail.com&gt;
CommitDate: Sun Aug 30 10:24:05 2015 +0200

    Atomically set CLOEXEC on duplicated sockets
    
    For Bitrig, NetBSD and OpenBSD the constant was incorrectly in posix01, when
    it's actually posix08, so we move it. This is a [breaking-change], but we
    already had one in #27930.
    
    Fix NetBSD's F_DUPFD_CLOEXEC constant.
    
    For a similar feature detection, see this musl thread:
    http://comments.gmane.org/gmane.linux.lib.musl.general/2963
    
    This assumes that an int literal has type `c_int` for varidic functions.

commit db67cbe43dfce043c664c53d709b91252d5afc9e
Merge: 63ba780 1994875
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Aug 24 10:03:48 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Aug 24 10:03:48 2015 +0000

    Auto merge of #27856 - nikomatsakis:move-def-id-to-rustc, r=eddyb
    
    It doesn't really make sense for DefId to be in libsyntax -- it is concerned with a single crate only. It is the compiler that understands the idea of many crates. (At some point, there might be a useful intermediate point here.) This is a refactoring in support of incr. compilation, which will be adjusting the notion of a DefId to make it more durable across compilations.
    
    This will probably be a [breaking-change] for every plugin ever. You need to adjust things as follows:
    
        use rustc::middle::def_id::{DefId, LOCAL_CRATE}; // two most common definitions
        ast_util::is_local(def_id) =&gt; def_id.is_local()
        ast_util::local_def(node_id) =&gt; DefId::local(node_id)

commit 983d2b3d1a97846c90ea8f689774be8353b340be
Merge: a03ec1a 12216b7
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Sat Aug 22 06:30:53 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Sat Aug 22 06:30:53 2015 +0000

    Auto merge of #27826 - sfackler:wait-timeout-enum, r=alexcrichton
    
    Returning a primitive bool results in a somewhat confusing API - does
    `true` indicate success - i.e. no timeout, or that a timeout has
    occurred? An explicitly named enum makes it clearer.
    
    [breaking-change]
    
    r? @alexcrichton

commit 42a386fcf89a40e6c3a8806ccf381514c2a77c10
Author:     Steven Fackler &lt;sfackler@gmail.com&gt;
AuthorDate: Thu Aug 13 21:58:20 2015 -0700
Commit:     Steven Fackler &lt;sfackler@gmail.com&gt;
CommitDate: Wed Aug 19 17:00:15 2015 -0700

    Make Condvar::wait_timeout return an enum instead of a bool
    
    Returning a primitive bool results in a somewhat confusing API - does
    `true` indicate success - i.e. no timeout, or that a timeout has
    occurred? An explicitly named enum makes it clearer.
    
    [breaking-change]

commit c66554cab3518a9f5c36eafd622ca4c8a3fda631
Author:     Huon Wilson &lt;dbau.pp+github@gmail.com&gt;
AuthorDate: Mon Jul 13 11:57:46 2015 -0700
Commit:     Huon Wilson &lt;dbau.pp+github@gmail.com&gt;
CommitDate: Mon Aug 17 14:41:37 2015 -0700

    switch core::simd to repr(simd) and deprecate it.
    
    This functionality will be available out of tree in the `simd` crate on
    crates.io.
    
    [breaking-change]

commit bb954cfa75ec63b2cf28229ecc4aee7024381d0b
Merge: e9205a2 15518a9
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Thu Aug 13 13:29:38 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Thu Aug 13 13:29:38 2015 +0000

    Auto merge of #27307 - rkruppe:dec2flt, r=pnkfelix
    
    Completely rewrite the conversion of decimal strings to `f64` and `f32`. The code is intended to be absolutely positively completely 100% accurate (when it doesn't give up). To the best of my knowledge, it achieves that goal. Any input that is not rejected is converted to the floating point number that is closest to the true value of the input. This includes overflow, subnormal numbers, and underflow to zero. In other words, the rounding error is less than or equal to 0.5 units in the last place. Half-way cases (exactly 0.5 ULP error) are handled with half-to-even rounding, also known as banker's rounding.
    
    This code implements the algorithms from the paper [How to Read Floating Point Numbers Accurately][paper] by William D. Clinger, with extensions to handle underflow, overflow and subnormals, as well as some algorithmic optimizations.
    
    # Correctness
    
    With such a large amount of tricky code, many bugs are to be expected. Indeed tracking down the obscure causes of various rounding errors accounts for the bulk of the development time. Extensive tests (taking in the order of hours to run through to completion) are included in `src/etc/test-float-parse`: Though exhaustively testing all possible inputs is impossible, I've had good success with generating millions of instances from various "classes" of inputs. These tests take far too long to be run by @bors so contributors who touch this code need the discipline to run them. There are `#[test]`s, but they don't even cover every stupid mistake I made in course of writing this.
    
    Another aspect is *integer* overflow. Extreme (or malicious) inputs could cause overflow both in the machine-sized integers used for bookkeeping throughout the algorithms (e.g., the decimal exponent) as well as the arbitrary-precision arithmetic. There is input validation to reject all such cases I know of, and I am quite sure nobody will *accidentally* cause this code to go out of range. Still, no guarantees.
    
    # Limitations
    
    Noticed the weasel words "(when it doesn't give up)" at the beginning? Some otherwise well-formed decimal strings are rejected because spelling out the value of the input requires too many digits, i.e., `digits * 10^abs(exp)` can't be stored in a bignum. This only applies if the value is not "obviously" zero or infinite, i.e., if you take a near-infinity or near-zero value and add many pointless fractional digits. At least with the algorithm used here, computing the precise value would require computing the full value as a fraction, which would overflow. The precise limit is `number_of_digits + abs(exp) &gt; 375` but could be raised almost arbitrarily. In the future, another algorithm might lift this restriction entirely.
    
    This should not be an issue for any realistic inputs. Still, the code does reject inputs that would result in a finite float when evaluated with unlimited precision. Some of these inputs are even regressions that the old code (mostly) handled, such as `0.333...333` with 400+ `3`s. Thus this might qualify as [breaking-change].
    
    # Performance
    
    Benchmarks results are... tolerable. Short numbers that hit the fast paths (`f64` multiplication or shortcuts to zero/inf) have performance in the same order of magnitude as the old code tens of nanoseconds. Numbers that are delegated to Algorithm Bellerophon (using floats with 64 bit significand, implemented in software) are slower, but not drastically so (couple hundred nanoseconds).
    
    Numbers that need the AlgorithmM fallback (for `f64`, roughly everything below 1e-305 and above 1e305) take far, far longer, hundreds of microseconds. Note that my implementation is not quite as naive as the expository version in the paper (it needs one to four division instead of ~1000), but division is fundamentally pretty expensive and my implementation of it is extremely simple and slow.
    
    All benchmarks run on a mediocre laptop with a i5-4200U CPU under light load.
    
    # Binary size
    
    Unfortunately the implementation needs to duplicate almost all code: Once for `f32` and once for `f64`. Before you ask, no, this cannot be avoided, at least not completely (but see the Future Work section). There's also a precomputed table of powers of ten, weighing in at about six kilobytes.
    
    Running a stage1 `rustc` over a stand-alone program that simply parses pi to `f32` and `f64` and outputs both results reveals that the overhead vs. the old parsing code is about 44 KiB normally and about 28 KiB with LTO. It's presumably half of that + 3 KiB when only one of the two code paths is exercised.
    
    | rustc options                 | old       | new       | delta         |
    |---------------------------    |---------  |---------  |-----------    |
    | [nothing]                     | 2588375   | 2633828   | 44.39 KiB     |
    | -O                            | 2585211   | 2630688   | 44.41 KiB     |
    | -O -C lto                     | 1026353   | 1054981   | 27.96 KiB     |
    | -O -C lto -C link-args=-s     | 414208    | 442368    | 27.5 KiB      |
    
    # Future Work
    
    ## Directory layout
    
    The `dec2flt` code uses some types embedded deeply in the `flt2dec` module hierarchy, even though nothing about them it formatting-specific. They should be moved to a more conversion-direction-agnostic location at some point.
    
    ## Performance
    
    It could be much better, especially for large inputs. Some low-hanging fruit has been picked but much more work could be done. Some specific ideas are jotted down in `FIXME`s all over the code.
    
    ## Binary size
    
    One could try to compress the table further, though I am skeptical. Another avenue would be reducing the code duplication from basically everything being generic over `T: RawFloat`. Perhaps one can reduce the magnitude of the duplication by pushing the parts that don't need to know the target type into separate functions, but this is finicky and probably makes some code read less naturally.
    
    ## Other bases
    
    This PR leaves `f{32,64}::from_str_radix` alone. It only replaces `FromStr` (and thus `.parse()`). I am convinced that `from_str_radix` should not exist, and have proposed its [deprecation and speedy removal][deprecate-radix]. Whatever the outcome of that discussion, it is independent from, and out of scope for, this PR.
    
    Fixes #24557
    Fixes #14353
    
    r? @pnkfelix
    
    cc @lifthrasiir @huonw
    
    [paper]: http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.45.4152
    [deprecate-radix]: https://internals.rust-lang.org/t/deprecate-f-32-64-from-str-radix/2405

commit 50141d7e1e5b1b539d45240dff709fa68e7472c2
Merge: 8b37055 b51e009
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Tue Aug 11 03:47:16 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Tue Aug 11 03:47:16 2015 +0000

    Auto merge of #26818 - sfackler:duration-stabilization, r=aturon
    
    This commit stabilizes the `std::time` module and the `Duration` type.
    `Duration::span` remains unstable, and the `Display` implementation for
    `Duration` has been removed as it is still being reworked and all trait
    implementations for stable types are de facto stable.
    
    This is a [breaking-change] to those using `Duration`'s `Display`
    implementation.
    
    I'm opening this PR as a platform for discussion - there may be some method renaming to do as part of the stabilization process.

commit 999bdeca88a06938ac1e1c608091d3afe4d7e173
Author:     Steven Fackler &lt;sfackler@gmail.com&gt;
AuthorDate: Sun Jul 5 23:20:00 2015 -0700
Commit:     Steven Fackler &lt;sfackler@gmail.com&gt;
CommitDate: Mon Aug 10 20:04:18 2015 -0400

    Stabilize the Duration API
    
    This commit stabilizes the `std::time` module and the `Duration` type.
    `Duration::span` remains unstable, and the `Display` implementation for
    `Duration` has been removed as it is still being reworked and all trait
    implementations for stable types are de facto stable.
    
    This is a [breaking-change] to those using `Duration`'s `Display`
    implementation.

commit ba792a4baa856d83c3001afa181db91c5b4c9732
Author:     Robin Kruppe &lt;robin.kruppe@gmail.com&gt;
AuthorDate: Sun Jul 26 17:50:29 2015 +0200
Commit:     Robin Kruppe &lt;robin.kruppe@gmail.com&gt;
CommitDate: Sat Aug 8 17:15:31 2015 +0200

    Accurate decimal-to-float parsing routines.
    
    This commit primarily adds implementations of the algorithms from William
    Clinger's paper "How to Read Floating Point Numbers Accurately". It also
    includes a lot of infrastructure necessary for those algorithms, and some
    unit tests.
    
    Since these algorithms reject a few (extreme) inputs that were previously
    accepted, this could be seen as a [breaking-change]

commit 87055a68c3194db212456f99ece080728a5fc2f8
Merge: f97a82f 3e954a8
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Thu Jul 30 10:25:23 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Thu Jul 30 10:25:23 2015 +0000

    Auto merge of #27371 - Gankro:str-clone, r=alexcrichton
    
    This is a minor [breaking-change], as it changes what
    `boxed_str.to_owned()` does (previously it would deref to `&amp;str` and
    call `to_owned` on that to get a `String`). However `Box&lt;str&gt;` is such an
    exceptionally rare type that this is not expected to be a serious
    concern. Also a `Box&lt;str&gt;` can be freely converted to a `String` to
    obtain the previous result anyway.

commit 3e954a8cb2fd094d79713059d83d37b2daa7b396
Author:     Alexis Beingessner &lt;a.beingessner@gmail.com&gt;
AuthorDate: Mon Jul 27 09:06:00 2015 -0700
Commit:     Alexis Beingessner &lt;a.beingessner@gmail.com&gt;
CommitDate: Wed Jul 29 18:43:01 2015 -0700

    implement Clone for Box&lt;str&gt;, closes #27323
    
    This is a minor [breaking-change], as it changes what
    `boxed_str.to_owned()` does (previously it would deref to `&amp;str` and
    call `to_owned` on that to get a `String`). However `Box&lt;str&gt;` is such an
    exceptionally rare type that this is not expected to be a serious
    concern. Also a `Box&lt;str&gt;` can be freely converted to a `String` to
    obtain the previous behaviour anyway.

commit d576ef3d7be3efe28f902bbb3b2197f4553db412
Merge: 4b4119d e99b53e
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Wed Jul 29 06:47:55 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Wed Jul 29 06:47:55 2015 +0000

    Auto merge of #27261 - arielb1:drop-sanity-check, r=pnkfelix
    
    This fixes multiple bugs, and as several of these are soundness issue, is a [breaking-change].
    
    r? @pnkfelix

commit 55ede7ed8e4f3752c371f7d04da4695ba9aa1c26
Merge: ba9224f 00a5e66
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Tue Jul 28 21:14:28 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Tue Jul 28 21:14:28 2015 +0000

    Auto merge of #27234 - oli-obk:move_get_name_get_ident_to_impl, r=eddyb
    
    this has quite some fallout. but also made lots of stuff more readable imo
    
    [breaking-change] for plugin authors

commit 757b0c176fa185fda59283efaf0d8079b702ca69
Author:     Ariel Ben-Yehuda &lt;arielb1@mail.tau.ac.il&gt;
AuthorDate: Tue Jul 28 16:52:54 2015 +0300
Commit:     Ariel Ben-Yehuda &lt;arielb1@mail.tau.ac.il&gt;
CommitDate: Tue Jul 28 19:51:08 2015 +0300

    prohibit the lhs of an @-pattern being a constant
    
    as this breaks code that worked under some conditions, this is a
    [breaking-change]
    
    Fixes #27033
    Fixes #27077

commit 661a5ad38e79f336976b529aa717871d177ab7ed
Merge: ec49d01 b4dd765
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Tue Jul 28 15:15:00 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Tue Jul 28 15:15:00 2015 +0000

    Auto merge of #26173 - pnkfelix:fsk-trans-nzmove-take3, r=nikomatsakis
    
    Add dropflag hints (stack-local booleans) for unfragmented paths in trans.  Part of #5016.
    
    Added code to maintain these hints at runtime, and to conditionalize drop-filling and calls to destructors.
    
    In this early stage of my incremental implementation strategy, we are using hints, so we are always free to leave out a flag for a path -- then we just pass `None` as the dropflag hint in the corresponding schedule cleanup call. But, once a path has a hint, we must at least maintain it: i.e. if the hint exists, we must ensure it is never set to "moved" if the data in question might actually have been initialized. It remains sound to conservatively set the hint to "initialized" as long as the true drop-flag embedded in the value itself is up-to-date.
    
    I hope the commit series has been broken up to be readable; most of the commits in the series should build (though I did not always check this).
    
    ----
    
    Oh, I think this technically qualifies as a:
    [breaking-change]
    because it removes drop-filling in some cases where one could previously observe it. That should only affect `unsafe` code; no safe code should be able to inspect whether the drop-fill was present or not. For an example of code that needed to change to account for this, see commit a81c24ae0216ab47df59acd724f8a33124fb6d97 (a unit test of the `move_val_init` intrinsic).  I have not encountered actual code that needed to be updated to account for the change, since this should only be skipping the drop-filling on *moved* values, not on dropped one, and so even types that use `unsafe_no_drop_flag` should be unchanged by this particular PR. (Their time will come later.)

commit bfbc7bc45d66ba7be8ab2ba60316cb1e303f4544
Author:     Ariel Ben-Yehuda &lt;arielb1@mail.tau.ac.il&gt;
AuthorDate: Fri Jul 24 01:38:42 2015 +0300
Commit:     Ariel Ben-Yehuda &lt;ariel.byd@gmail.com&gt;
CommitDate: Fri Jul 24 23:46:17 2015 +0300

    handle all type variants correctly in dropck
    
    This fixes a few soundness bugs in dropck, so to anyone who relied on them,
    this is a
    [breaking-change]
    
    Fixes #24086.
    Fixes #25389.
    Fixes #25598.
    Fixes #25750.
    Fixes #26641.
    Fixes #26657.
    Fixes #27240.
    Fixes #27241.

commit 18557500cb91596f3614d4cf65439f8c5f47b2e0
Merge: 39d4faf 0ca8e49
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Jul 20 16:38:33 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Jul 20 16:38:33 2015 +0000

    Auto merge of #27026 - nagisa:overflowing-unsigned, r=pnkfelix
    
    This commit fixes the negate_unsigned feature gate to appropriately
    account for inferred variables.
    
    This is technically a [breaking-change], but I’d consider it a bug fix.
    
    cc @brson for your relnotes.
    
    Fixes https://github.com/rust-lang/rust/issues/24676
    Fixes #26840
    Fixes https://github.com/rust-lang/rust/issues/25206

commit e05ac3938bcbdd616930bb010a3bbfa35f22850e
Merge: d4432b3 de6b3c2
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Fri Jul 17 18:35:50 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Fri Jul 17 18:35:50 2015 +0000

    Auto merge of #27045 - nikomatsakis:better-object-defaults-error, r=pnkfelix
    
    Transition to the new object lifetime defaults, replacing the old defaults completely.
    
    r? @pnkfelix
    
    This is a [breaking-change] as specified by [RFC 1156][1156] (though all cases that would break should have been receiving warnings starting in Rust 1.2). Types like `&amp;'a Box&lt;Trait&gt;` (or `&amp;'a Rc&lt;Trait&gt;`, etc) will change from being interpreted as `&amp;'a Box&lt;Trait+'a&gt;` to `&amp;'a Box&lt;Trait+'static&gt;`. To restore the old behavior, write the `+'a` explicitly. For example, the function:
    
    
    ```rust
    trait Trait { }
    fn foo(x: &amp;Box&lt;Trait&gt;) { ... }
    ```
    
    would be rewritten as:
    
    ```rust
    trait Trait { }
    fn foo(x: &amp;'a Box&lt;Trait+'a&gt;) { ... }
    ```
    
    if one wanted to preserve the current typing.
    
    [1156]: https://github.com/rust-lang/rfcs/blob/master/text/1156-adjust-default-object-bounds.md

commit 0c9e3dc75cf2b2d122af0596225594240ed254eb
Author:     Simonas Kazlauskas &lt;git@kazlauskas.me&gt;
AuthorDate: Tue Jul 14 01:03:24 2015 +0300
Commit:     Simonas Kazlauskas &lt;git@kazlauskas.me&gt;
CommitDate: Tue Jul 14 21:48:43 2015 +0300

    Fix negate_unsigned feature gate check
    
    This commit fixes the negate_unsigned feature gate to appropriately
    account for infered variables.
    
    This is technically a [breaking-change].

commit 6b27005f2f8b20834838828588233b877a29d509
Author:     Ariel Ben-Yehuda &lt;arielb1@mail.tau.ac.il&gt;
AuthorDate: Tue Jun 30 20:30:47 2015 +0300
Commit:     Ariel Ben-Yehuda &lt;arielb1@mail.tau.ac.il&gt;
CommitDate: Sat Jul 4 14:09:26 2015 +0300

    require reimplementations of all items when a defaulted associated type is overriden
    
    This is a
    [breaking-change]
    but it follows the RFC (not sure whether it will be accepted).

commit f027bdc1c8a133693651f333624b756abe21960f
Merge: 7b14838 a18d984
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Fri Jul 3 21:31:46 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Fri Jul 3 21:31:46 2015 +0000

    Auto merge of #26378 - arielb1:unused-mut, r=pnkfelix
    
    This makes it somewhat more aggressive, so this is kind-of a [breaking-change] for these compiling with `#[deny(unused_mut)]`.
    
    r? @pnkfelix

commit 31d9aee68499cba8d1a5332b841eca5c67991001
Merge: 4a788a2 5133606
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Jun 22 00:11:00 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Jun 22 00:11:00 2015 +0000

    Auto merge of #26394 - arielb1:implement-rfc401-part2, r=nrc
    
    This makes them compliant with the new version of RFC 401 (i.e.
        RFC 1052).
    
    Fixes #26391. I *hope* the tests I have are enough.
    
    This is a [breaking-change]
    
    r? @nrc

commit ea7637ebc0e5d325ccf0537a8013316c2ed78108
Author:     Ariel Ben-Yehuda &lt;arielb1@mail.tau.ac.il&gt;
AuthorDate: Thu Jun 18 15:51:06 2015 +0300
Commit:     Ariel Ben-Yehuda &lt;arielb1@mail.tau.ac.il&gt;
CommitDate: Thu Jun 18 15:51:06 2015 +0300

    Prohibit casts between fat pointers to different traits
    
    This makes them compliant with the new version of RFC 401 (i.e.
        RFC 1052).
    
    Fixes #26391. I *hope* the tests I have are enough.
    
    This is a [breaking-change]

commit 713d9176adc5072afdf0934dc95b868995e867c0
Merge: 8af39ce 957935a
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Wed Jun 17 22:50:17 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Wed Jun 17 22:50:17 2015 +0000

    Auto merge of #26326 - nikomatsakis:optimize-fulfillment-cache-in-tcx, r=pcwalton
    
    When we successfully resolve a trait reference with no type/lifetime parameters, like `i32: Foo` or `Box&lt;u32&gt;: Sized`, this is in fact globally true. This patch adds a simple global to the tcx to cache such cases. The main advantage of this is really about caching things like `Box&lt;Vec&lt;Foo&gt;&gt;: Sized`. It also points to the need to revamp our caching infrastructure -- the current caches make selection cost cheaper, but we still wind up paying a high cost in the confirmation process, and in particular unrolling out dependent obligations. Moreover, we should probably do caching more uniformly and with a key that takes the where-clauses into account. But that's for later.
    
    For me, this shows up as a reasonably nice win (20%) on Servo's script crate (when built in dev mode). This is not as big as my initial measurements suggested, I think because I was building my rustc with more debugging enabled at the time. I've not yet done follow-up profiling and so forth to see where the new hot spots are. Bootstrap times seem to be largely unaffected.
    
    cc @pcwalton
    
    This is technically a [breaking-change] in that functions with unsatisfiable where-clauses may now yield errors where before they may have been accepted. Even before, these functions could never have been *called* by actual code. In the future, such functions will probably become illegal altogether, but in this commit they are still accepted, so long as they do not rely on the unsatisfiable where-clauses. As before, the functions still cannot be called in any case.

commit 73fb19c04ac227fe2aad2c618f76b6eb05dd7ec9
Merge: a53a098 3ca4d92
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Jun 15 19:52:15 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Jun 15 19:52:15 2015 +0000

    Auto merge of #26275 - arielb1:unconstrained-projection, r=nikomatsakis
    
    Fixes #26262
    
    Because this rejects code that previously compiled, this is a [breaking-change]
    
    r? @nikomatsakis

commit 7517ecf4fc9cfe2adff8a38ecc2ef660692a4b5b
Merge: a54a809 a7bbd7d
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Mon Jun 15 06:44:42 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Mon Jun 15 06:44:42 2015 +0000

    Auto merge of #26168 - sfackler:stdout-panic, r=alexcrichton
    
    Closes #25977
    
    The various `stdfoo_raw` methods in std::io now return `io::Result`s,
    since they may not exist on Windows. They will always return `Ok` on
    Unix-like platforms.
    
    [breaking-change]

commit a7bbd7da4eb98127104fdfd415ad6c746f7e2a12
Author:     Steven Fackler &lt;sfackler@gmail.com&gt;
AuthorDate: Tue Jun 9 21:39:36 2015 -0700
Commit:     Steven Fackler &lt;sfackler@gmail.com&gt;
CommitDate: Sun Jun 14 20:17:06 2015 -0700

    Implement RFC 1014
    
    Closes #25977
    
    The various `stdfoo_raw` methods in std::io now return `io::Result`s,
    since they may not exist on Windows. They will always return `Ok` on
    Unix-like platforms.
    
    [breaking-change]

commit 7648776503040b302fe0589311fb27afe7c1e6cc
Merge: 400e955 3be18f0
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Fri Jun 12 00:00:27 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Fri Jun 12 00:00:27 2015 +0000

    Auto merge of #26225 - arielb1:raw-self, r=eddyb
    
    This can't be made to work with the current setup.
    
    Technically a [breaking-change], but a simple bug fix.
    
    Fixes #26194.

commit b70f49b86fa4d8780f46e869880e84e1c24c2f19
Merge: 9a2f68e 5235065
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Wed Jun 3 18:21:09 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Wed Jun 3 18:21:09 2015 +0000

    Auto merge of #24910 - steveklabnik:remove_static_assert, r=alexcrichton
    
    This was always a weird feature, and isn't being used in the compiler.
    Static assertions should be done better than this.
    
    Fixes #13951
    Fixes #23008
    Fixes #6676
    
    This is behind a feature gate, but that's still a
    
    [breaking-change]
    
    (It's not entirely clear to me that this should or shouldn't have an RFC, but if it does, I'm fine blocking on such a thing.)

commit 5235065d740cad78ab55a89299fc1f5d32bf8f46
Author:     Steve Klabnik &lt;steve@steveklabnik.com&gt;
AuthorDate: Tue Apr 28 16:45:22 2015 -0400
Commit:     Steve Klabnik &lt;steve@steveklabnik.com&gt;
CommitDate: Wed Jun 3 09:38:13 2015 -0400

    Remove #[static_assert]
    
    This was always a weird feature, and isn't being used in the compiler.
    Static assertions should be done better than this.
    
    This implements RFC #1096.
    
    Fixes #13951
    Fixes #23008
    Fixes #6676
    
    This is behind a feature gate, but that's still a
    
    [breaking-change]

commit 32211e1d27c258c62cafb6ba357e67db932367bf
Author:     Ulrik Sverdrup &lt;root@localhost&gt;
AuthorDate: Sat May 30 22:03:57 2015 +0200
Commit:     Ulrik Sverdrup &lt;root@localhost&gt;
CommitDate: Sat May 30 22:15:40 2015 +0200

    Mark Arc function get_mut and method make_unique unsafe
    
    This is a temporary mitigation for issue #24880 which points out that
    these functions are racy in a particular situation where weak pointers
    exist.
    
    To mitigate this, mark the functions unsafe until this can be fixed or
    another decision is made.
    
    This is a breaking change to unstable API, because the new version
    requires an `unsafe` block. Review carefully if weak pointers may race
    for any uses of this API and consider abandoning it.
    
    [breaking-change]

commit bd85983d059151c9ef07dbd11a35f1d16463eb94
Author:     Steven Fackler &lt;sfackler@gmail.com&gt;
AuthorDate: Sun May 17 13:17:26 2015 -0700
Commit:     Steven Fackler &lt;sfackler@gmail.com&gt;
CommitDate: Sun May 17 17:33:29 2015 -0700

    Make debug builders take &amp;mut self, add entries method
    
    [breaking-change]

commit c23a9d42ea082830593a73d25821842baf9ccf33
Merge: 2da9efe 8cc9878
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Sun May 17 00:05:34 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Sun May 17 00:05:34 2015 +0000

    Auto merge of #25387 - eddyb:syn-file-loader, r=nikomatsakis
    
    This allows compiling entire crates from memory or preprocessing source files before they are tokenized.
    
    Minor API refactoring included, which is a [breaking-change] for libsyntax users:
    * `ParseSess::{next_node_id, reserve_node_ids}` moved to rustc's `Session`
    * `new_parse_sess` -&gt; `ParseSess::new`
    * `new_parse_sess_special_handler` -&gt; `ParseSess::with_span_handler`
    * `mk_span_handler` -&gt; `SpanHandler::new`
    * `default_handler` -&gt; `Handler::new`
    * `mk_handler` -&gt; `Handler::with_emitter`
    * `string_to_filemap(sess source, path)` -&gt; `sess.codemap().new_filemap(path, source)`

commit 67ba6dcf68860d8a20891faad88a33b35ed58df5
Merge: 4979423 1aecd17
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Sat May 9 14:56:56 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Sat May 9 14:56:56 2015 +0000

    Auto merge of #24612 - lifthrasiir:flt2dec, r=pnkfelix
    
    This is a direct port of my prior work on the float formatting. The detailed description is available [here](https://github.com/lifthrasiir/rust-strconv#flt2dec). In brief,
    
    * This adds a new hidden module `core::num::flt2dec` for testing from `libcoretest`. Why is it in `core::num` instead of `core::fmt`? Because I envision that the table used by `flt2dec` is directly applicable to `dec2flt` (cf. #24557) as well, which exceeds the realm of "formatting".
    * This contains both Dragon4 algorithm (exact, complete but slow) and Grisu3 algorithm (exact, fast but incomplete).
    * The code is accompanied with a large amount of self-tests and some exhaustive tests. In particular, `libcoretest` gets a new dependency on `librand`. For the external interface it relies on the existing test suite.
    * It is known that, in the best case, the entire formatting code has about 30 KBs of binary overhead (judged from strconv experiments). Not too bad but there might be a potential room for improvements.
    
    This is rather large code. I did my best to comment and annotate the code, but you have been warned.
    
    For the maximal availability the original code was licensed in CC0, but I've also dual-licensed it in MIT/Apache as well so there should be no licensing concern.
    
    This is [breaking-change] as it changes the float output slightly (and it also affects the casing of `inf` and `nan`). I hope this is not a big deal though :)
    
    Fixes #7030, #18038 and #24556. Also related to #6220 and #20870.
    
    ## Known Issues
    
    - [x] I've yet to finish `make check-stage1`. It does pass main test suites including `run-pass` but there might be some unknown edges on the doctests.
    - [ ] Figure out how this PR affects rustc.
    - [ ] Determine which internal routine is mapped to the formatting specifier. Depending on the decision, some internal routine can be safely removed (for instance, currently `to_shortest_str` is unused).

commit 3906edf41e8faa0610daea954ffbda39841fbc0d
Merge: 95400c5 8654dfb
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Sat May 9 09:20:43 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Sat May 9 09:20:43 2015 +0000

    Auto merge of #25212 - pnkfelix:dropck-box-trait, r=nikomatsakis
    
    dropck: must assume `Box&lt;Trait + 'a&gt;` has a destructor of interest.
    
    Fix #25199.
    
    This detail was documented in [RFC 769]; the implementation was just missing.
    
    [breaking-change]
    
    The breakage here falls into both obvious and non-obvious cases.
    
    The obvious case: if you were relying on the unsoundness this exposes (namely being able to reference dead storage from a destructor, by doing it via a boxed trait object bounded by the lifetime of the dead storage), then this change disallows that.
    
    The non-obvious cases: The way dropck works, it causes lifetimes to be extended to longer extents than they covered before. I.e.  lifetimes that are attached as trait-bounds may become longer than they were previously.
    
    * This includes lifetimes that are only *implicitly* attached as trait-bounds (due to [RFC 599]). So you may have code that was e.g. taking a parameter of type `&amp;'a Box&lt;Trait&gt;` (which expands to `&amp;'a Box&lt;Trait+'a&gt;`), that now may need to be assigned type `&amp;'a Box&lt;Trait+'static&gt;` to ensure that `'a` is not inadvertantly inferred to a region that is actually too long.  (See commit ee06263 for an example of this.)
    
    [RFC 769]: https://github.com/rust-lang/rfcs/blob/master/text/0769-sound-generic-drop.md#the-drop-check-rule
    
    [RFC 599]: https://github.com/rust-lang/rfcs/blob/master/text/0599-default-object-bound.md

commit b5b5a177588c0e8dfc6b9e79540bcbd1eeb9ef91
Author:     Felix S. Klock II &lt;pnkfelix@pnkfx.org&gt;
AuthorDate: Fri May 8 15:06:16 2015 +0200
Commit:     Felix S. Klock II &lt;pnkfelix@pnkfx.org&gt;
CommitDate: Fri May 8 15:06:16 2015 +0200

    dropck: must assume `Box&lt;Trait + 'a&gt;` has a destructor of interest.
    
    Implements this (previously overlooked) note from [RFC 769]:
    
    &gt; (Note: When encountering a D of the form `Box&lt;Trait+'b&gt;`, we
    &gt; conservatively assume that such a type has a Drop implementation
    &gt; parametric in 'b.)
    
    Fix #25199.
    
    [breaking-change]
    
    The breakage here falls into both obvious and non-obvious cases.
    
    The obvious case: if you were relying on the unsoundness this exposes
    (namely being able to reference dead storage from a destructor, by
    doing it via a boxed trait object bounded by the lifetime of the dead
    storage), then this change disallows that.
    
    The non-obvious cases: The way dropck works, it causes lifetimes to be
    extended to longer extents than they covered before. I.e.  lifetimes
    that are attached as trait-bounds may become longer than they were
    previously.
    
    * This includes lifetimes that are only *implicitly* attached as
      trait-bounds (due to [RFC 599]). So you may have code that was
      e.g. taking a parameter of type `&amp;'a Box&lt;Trait&gt;` (which expands to
      `&amp;'a Box&lt;Trait+'a&gt;`), that now may need to be assigned type `&amp;'a
      Box&lt;Trait+'static&gt;` to ensure that `'a` is not inadvertantly
      inferred to a region that is actually too long.  (See earlier commit
      in this PR for an example of this.)
    
    [RFC 769]: https://github.com/rust-lang/rfcs/blob/master/text/0769-sound-generic-drop.md#the-drop-check-rule
    
    [RFC 599]: https://github.com/rust-lang/rfcs/blob/master/text/0599-default-object-bound.md

commit 5ae026e8923d71d16a4d2b9a592bbcab92d8723a
Merge: f0ac7e0 8d3f84e
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Thu May 7 21:45:11 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Thu May 7 21:45:11 2015 +0000

    Auto merge of #25157 - alexcrichton:remove-vec-add, r=aturon
    
    Ideally this trait implementation would be unstable, requiring crates to opt-in
    if they would like the functionality, but that's not currently how stability
    works so the implementation needs to be removed entirely.
    
    This may come back at a future date, but for now the conservative option is to
    remove it.
    
    [breaking-change]

commit 8d3f84e235b22688dd1592cfb86f31459a79ac5f
Author:     Alex Crichton &lt;alex@alexcrichton.com&gt;
AuthorDate: Wed May 6 10:51:10 2015 -0700
Commit:     Alex Crichton &lt;alex@alexcrichton.com&gt;
CommitDate: Wed May 6 10:52:34 2015 -0700

    std: Remove addition on vectors for now
    
    Ideally this trait implementation would be unstable, requiring crates to opt-in
    if they would like the functionality, but that's not currently how stability
    works so the implementation needs to be removed entirely.
    
    This may come back at a future date, but for now the conservative option is to
    remove it.
    
    [breaking-change]

commit d131f335579b8c080a2416a65ca703169fae560b
Author:     Sean McArthur &lt;sean.monstar@gmail.com&gt;
AuthorDate: Mon Apr 13 14:49:10 2015 -0700
Commit:     Sean McArthur &lt;sean.monstar@gmail.com&gt;
CommitDate: Tue May 5 22:26:23 2015 -0700

    lint: deny transmuting from immutable to mutable, since it's undefined behavior
    
    [breaking-change] Technically breaking, since code that had been using
    these transmutes before will no longer compile. However, it was
    undefined behavior, so really, it's a good thing. Fixing your code would
    require some re-working to use an UnsafeCell instead.
    
    Closes #13146

commit 5aa9f38285b47e2eadaaac0e343da90b922994f1
Author:     Kang Seonghoon &lt;public+git@mearie.org&gt;
AuthorDate: Mon Apr 20 01:36:55 2015 +0900
Commit:     Kang Seonghoon &lt;public+git@mearie.org&gt;
CommitDate: Wed May 6 14:21:41 2015 +0900

    core: made the core formatter to use a new flt2dec.
    
    As a side effect `core::fmt::float` is gone now. This also slightly
    changes the float output, so this is:
    
    [breaking-change]

commit eae692e375cec222803efb7175c79fedc228eea9
Merge: 6cd7486 db477ee
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Tue May 5 18:18:27 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Tue May 5 18:18:27 2015 +0000

    Auto merge of #25009 - alexcrichton:less-buffered-stream, r=aturon
    
    As pointed out in #17136 the semantics of a `BufStream` aren't always what one
    expects, and it looks like other [languages like C#][c-sharp] implement a
    buffered stream with only one underlying buffer. For now this commit
    destabilizes the primitive in the `std::io` module to give us some more time in
    figuring out what to do with it.
    
    [c-sharp]: https://msdn.microsoft.com/en-us/library/system.io.bufferedstream%28v=vs.110%29.aspx
    
    [breaking-change]

commit f6574c5b0404f55c4dd4056be47d37eff33684b5
Merge: f3345cb b1976f1
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Fri May 1 22:54:09 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Fri May 1 22:54:09 2015 +0000

    Auto merge of #25006 - alexcrichton:unstable-indexing, r=aturon
    
    These implementations were intended to be unstable, but currently the stability
    attributes cannot handle a stable trait with an unstable `impl` block. This
    commit also audits the rest of the standard library for explicitly-`#[unstable]`
    impl blocks. No others were removed but some annotations were changed to
    `#[stable]` as they're defacto stable anyway.
    
    One particularly interesting `impl` marked `#[stable]` as part of this commit
    is the `Add&lt;&amp;[T]&gt;` impl for `Vec&lt;T&gt;`, which uses `push_all` and implicitly
    clones all elements of the vector provided.
    
    Closes #24791
    
    [breaking-change]

commit 5c710b593b429d39ea01375172a9ce968f43ab26
Merge: c634ec2 a576262
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Fri May 1 04:22:53 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Fri May 1 04:22:53 2015 +0000

    Auto merge of #24793 - aturon:io-error-any, r=alexcrichton
    
    This commit brings the `Error` trait in line with the [Error interoperation
    RFC](https://github.com/rust-lang/rfcs/pull/201) by adding downcasting,
    which has long been intended. This change means that for any `Error`
    trait objects that are `'static`, you can downcast to concrete error
    types.
    
    To make this work, it is necessary for `Error` to inherit from
    `Reflect` (which is currently used to mark concrete types as "permitted
    for reflection, aka downcasting"). This is a breaking change: it means
    that impls like
    
    ```rust
    impl&lt;T&gt; Error for MyErrorType&lt;T&gt; { ... }
    ```
    
    must change to
    
    ```rust
    impl&lt;T: Reflect&gt; Error for MyErrorType&lt;T&gt; { ... }
    ```
    
    This commit furthermore marks `Reflect` as stable, since we are already
    essentially committed to it via `Any`. Note that in the future, if we
    determine that the parametricity aspects of `Reflect` are not needed, we
    can deprecate the trait and provide a blanket implementation for it
    for *all* types (rather than by using OIBIT), which would allow all
    mentions of `Reflect` to be dropped over time. So there is not a strong
    commitment here.
    
    [breaking-change]
    
    r? @alexcrichton

commit a5762625a168f195afbc5b74d674a93f8c692a8e
Author:     Aaron Turon &lt;aturon@mozilla.com&gt;
AuthorDate: Fri Apr 24 14:34:57 2015 -0700
Commit:     Aaron Turon &lt;aturon@mozilla.com&gt;
CommitDate: Thu Apr 30 18:20:22 2015 -0700

    Add downcasting to std::error::Error
    
    This commit brings the `Error` trait in line with the [Error interoperation
    RFC](https://github.com/rust-lang/rfcs/pull/201) by adding downcasting,
    which has long been intended. This change means that for any `Error`
    trait objects that are `'static`, you can downcast to concrete error
    types.
    
    To make this work, it is necessary for `Error` to inherit from
    `Reflect` (which is currently used to mark concrete types as "permitted
    for reflection, aka downcasting"). This is a breaking change: it means
    that impls like
    
    ```rust
    impl&lt;T&gt; Error for MyErrorType&lt;T&gt; { ... }
    ```
    
    must change to something like
    
    ```rust
    impl&lt;T: Reflect&gt; Error for MyErrorType&lt;T&gt; { ... }
    ```
    
    except that `Reflect` is currently unstable (and should remain so for
    the time being). For now, code can instead bound by `Any`:
    
    ```rust
    impl&lt;T: Any&gt; Error for MyErrorType&lt;T&gt; { ... }
    ```
    
    which *is* stable and has `Reflect` as a super trait. The downside is
    that this imposes a `'static` constraint, but that only
    constrains *when* `Error` is implemented -- it does not actually
    constrain the types that can implement `Error`.
    
    [breaking-change]

commit db477eef72924c7b34e9617627eaae37c71bdc1c
Author:     Alex Crichton &lt;alex@alexcrichton.com&gt;
AuthorDate: Thu Apr 30 15:45:48 2015 -0700
Commit:     Alex Crichton &lt;alex@alexcrichton.com&gt;
CommitDate: Thu Apr 30 16:02:58 2015 -0700

    std: Destabilize io::BufStream
    
    As pointed out in #17136 the semantics of a `BufStream` aren't always what one
    expects, and it looks like other [languages like C#][c-sharp] implement a
    buffered stream with only one underlying buffer. For now this commit
    destabilizes the primitive in the `std::io` module to give us some more time in
    figuring out what to do with it.
    
    [c-sharp]: https://msdn.microsoft.com/en-us/library/system.io.bufferedstream%28v=vs.110%29.aspx
    
    [breaking-change]

commit 441b3f0c26c2e30ddb012be968141da7ce7d9d62
Merge: d8b64c7 1f79348
Author:     bors &lt;bors@rust-lang.org&gt;
AuthorDate: Tue Apr 28 17:12:36 2015 +0000
Commit:     bors &lt;bors@rust-lang.org&gt;
CommitDate: Tue Apr 28 17:12:36 2015 +0000

    Auto merge of #24906 - pnkfelix:fsk-fix-24895, r=alexcrichton
    
    dropck: Remove `Copy` from special-cased traits
    
    Fix #24895.
    
    [breaking-change]
    
    What does this break?  Basically, code that implements `Drop` and is
    using `T:Copy` for one of its type parameters and is relying on the
    Drop Check rule not applying to it.
    
    Here is an example:
    
    ```rust
    #![allow(dead_code,unused_variables,unused_assignments)]
    struct D&lt;T:Copy&gt;(T);
    impl&lt;T:Copy&gt; Drop for D&lt;T&gt; { fn drop(&amp;mut self) { } }
    
    trait UserT { fn c(&amp;self) { } }
    impl&lt;T:Copy&gt; UserT for T { }
    struct E&lt;T:UserT&gt;(T);
    impl&lt;T:UserT&gt; Drop for E&lt;T&gt; { fn drop(&amp;mut self) { } }
    
    // This one will start breaking.
    fn foo() { let (d2, d1); d1 = D(34); d2 = D(&amp;d1); }
    
    #[cfg(this_one_does_and_should_always_break)]
    fn bar() { let (e2, e1); e1 = E(34); e2 = E(&amp;e1); }
    
    fn main() {
        foo();
    }
    ```

commit b892264ea4f048feb5f380d3e659d82ba463f5b7
Author:     Felix S. Klock II &lt;pnkfelix@pnkfx.org&gt;
AuthorDate: Tue Apr 28 17:47:16 2015 +0200
Commit:     Felix S. Klock II &lt;pnkfelix@pnkfx.org&gt;
CommitDate: Tue Apr 28 17:47:16 2015 +0200

    Fix #24895.
    
    [breaking-change]
    
    What does this break?  Basically, code that implements `Drop` and is
    using `T:Copy` for one of its type parameters and is relying on the
    Drop Check rule not applying to it.
    
    Here is an example:
    
    ```rust
    #![allow(dead_code,unused_variables,unused_assignments)]
    struct D&lt;T:Copy&gt;(T);
    impl&lt;T:Copy&gt; Drop for D&lt;T&gt; { fn drop(&amp;mut self) { } }
    
    trait UserT { fn c(&amp;self) { } }
    impl&lt;T:Copy&gt; UserT for T { }
    struct E&lt;T:UserT&gt;(T);
    impl&lt;T:UserT&gt; Drop for E&lt;T&gt; { fn drop(&amp;mut self) { } }
    
    // This one will start breaking.
    fn foo() { let (d2, d1); d1 = D(34); d2 = D(&amp;d1); }
    
    #[cfg(this_one_does_and_should_always_break)]
    fn bar() { let (e2, e1); e1 = E(34); e2 = E(&amp;e1); }
    
    fn main() {
        foo();
    }
    ```

commit b475fc7d6aa1cafa91790c273908fddfb669a82e
Author:     Ulrik Sverdrup &lt;root@localhost&gt;
AuthorDate: Mon Apr 27 19:37:13 2015 +0200
Commit:     Ulrik Sverdrup &lt;root@localhost&gt;
CommitDate: Tue Apr 28 11:38:33 2015 +0200

    collections: Implement vec::drain(range) according to RFC 574
    
    Old `.drain()` on vec is performed using `.drain(..)` now.
    
    `.drain(range)` is unstable and under feature(collections_drain)
    
    [breaking-change]
</pre></body></html>
